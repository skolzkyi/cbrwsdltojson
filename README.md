## О сервисе
Данный сервис позволяет получать данные с веб-сервиса ЦБ РФ(http://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx) в виде удобного json.  
Сервис завернут в контейнер, что удобно при использовании его в качестве источника данных для нескольких приложений или микросервисов.  
Зависимости от внешних SOAP-библиотек отсутствуют, лишние компоненты вроде SQL и NoSQL баз данных отсутствуют. Сервис задумывался как легковесная прокладка-конвертер между оргинальным веб-сервисом SOAP ЦБР и приложениями, нативно потребляющими json.
Сервис содержит в себе встроенный потоконезависимый кэш, что позволяет экономить на маршаллинге XML при запросе с сервиса ЦБР. 

## Настройки в config.env
  * `ADDRESS=cbrwsdltojson` - адрес, на котором поднимается сервис. При использовании в  контейнере менять не рекомендуется;  
  * `PORT=4000` - порт, на котором поднимается сервис;  
  * `SERVER_SHUTDOWN_TIMEOUT=30s` - таймаут для мягкого выключения сервиса(graceful shutdown);  
  * `CBR_WSDL_TIMEOUT=5s` - таймаут для запроса сервиса(целиком, включая анмаршаллинг и ответ);  
  * `CBR_WSDL_ADDRESS=http://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx` - эндпоинт сервиса ЦБР, менять не рекомендуется, добавлено на будущее на случай переезда сервиса;  
  * `DATE_TIME_RESPONSE_LAYOUT=2006-01-02` - формат временных данных для json-запроса в сервис, заполнять необходимо по правилам go layout(см ниже);  
  * `DATE_TIME_REQUEST_LAYOUT=2006-01-02` - формат временных данных для формирования json-ответа сервиса, заполнять необходимо по правилам go layout(см ниже);    
  * `PERMITTED_REQUESTS=` - список разрешенных методов, если список пуст, то разрешены все методы, если нет, то выполняться будут только методы из списка(например, `PERMITTED_REQUESTS=GetCursOnDateXML Coins_baseXML` - названия методов необходимо разделять пробелами);  
  * `LOGGING_ON=true` - триггер логирования в текстовый файл, опционально, при высоких нагрузках можно выключать для выигрыша производительности;  
  Как работает go datetime layout можно почитать, например, здесь: https://golang-blog.blogspot.com/2020/08/package-time-in-golang-time-format.html  

## Кэш
Кеширование данных происходит после первого запроса по данному методу после запуска сервиса.  
Для каждого метода есть возможность запросить принудительно данные напрямую, минуя кэш (данные в кэше после такого запроса также будут обновлены).  
Для принудительного прямого запроса надо выполнить запрос на хендлер вида `/GetMethodDataWithoutCache/[имя метода]` (например,  `/GetMethodDataWithoutCache/GetCursOnDateXML`)  

## Список поддерживаемых методов, примеры json запросов и ответов
  * <details><summary><b>GetCursOnDateXML</b></summary>
    <ul>
        <li>request: {"OnDate":"2023-06-22"} </li>
        <li>response: </li>
    </ul>
   </details>
  
